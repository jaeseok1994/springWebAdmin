<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>

    <title>사용자관리</title>
    <div th:replace="headerRGrid"></div>
    <div th:remove="all">
        <link href="/realgrid/realgrid.2.1.0/realgrid-style.css" rel="stylesheet" />
    <!--    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>-->
        <script src="/js/jquery/jquery-3.5.1.js"></script>
        <script src="/js/jquery/jquery-ui.js"></script>
        <script src="/js/jquery/select2.min.js"></script>
        <script src="/realgrid/realgrid.2.1.0/realgrid-lic.js"></script>
        <script src="/realgrid/realgrid.2.1.0/realgrid.2.1.0.js"></script>
        <script src="/realgrid/realgrid.2.1.0/libs/jszip.min.js"></script>
        <link href="/css/common_ui.css" rel="stylesheet" />
        <script src="/js/common/common_ui.js"></script>
        <script src="/js/common/common_transaction.js"></script>
        <script src="/js/vue/vue.js"></script>
    </div>
</head>
<script type="text/javascript">

</script>
<script>
    var fields = [
    //그리드에서 사용한 필드값들
      {fieldName: "userid",dataType: "text"},
      {fieldName: "usernm",dataType: "text"},
      {fieldName: "pass",dataType: "text"},
      {fieldName: "email",dataType: "text"},
      {fieldName: "useyn",dataType: "text"},
      {fieldName: "auth",dataType: "text"},
      {fieldName: "updtdate",dataType: "text"},
      {fieldName: "updtuser",dataType: "text"},
      {fieldName: "code",dataType: "text"},
      {fieldName: "name",dataType: "text"},
    ];
    //그리드에서 사용한 컬럼 설정 정의
    var columns = [
      {name: "userid", fieldName: "userid", type: "data", width: "90", header: { text: "사번" } },
      {name: "usernm", fieldName: "usernm", type: "data", width: "150", header: { text: "성명" } },
      {name: "pass", fieldName: "pass", type: "data", width: "80", header: { text: "비밀번호" } },
      {name: "email", fieldName: "email", type: "data", width: "200", header: { text: "E-MAIL" } },
      {name: "useyn", fieldName: "useyn", type: "data", width: "200", header: { text: "사용여부" },editable: false ,renderer:{type: "check",trueValues: 'Y',falseValues: 'N'} },
      {name: "auth", fieldName: "auth", type: "data", width: "200", header: { text: "권한" } },
      {name: "updtdate", fieldName: "updtdate", type: "data", width: "200", header: { text: "수정일" }, editor:{type:"date",mask:{ editMask:"9999-99-99", placeHolder:"yyyy-MM-dd", includedFormat:true },datetimeFormat:"yyyy-MM-dd" },datetimeFormat:"yyyy-MM-dd"},
      {name: "updtuser", fieldName: "updtuser", type: "data", width: "200", header: { text: "수정자" } },
    ];
    var columns1 = [
      {name: "auth", fieldName: "auth",  type: "data", width: "90", header: { text: "사용" } ,editable: false ,renderer:{type: "check",trueValues: 'Y',falseValues: 'N'}},
      {name: "name", fieldName: "name", type: "data", header: { text: "권한 명" } },
      {name: "updtdate", fieldName: "updtdate", type: "data", width: "150", header: { text: "수정일" } },
      {name: "updtuser", fieldName: "updtuser", type: "data", width: "80", header: { text: "수정자" } },
    ];

    var grid,grid2;

    var app;
    $(document.body).ready(function(){
        app = new Vue({
            el:'#form',
            data:{
                MenuList:['1'],
                loctList:[],
                keys:{
                    search:'',
                    comp:'',
                    loct:'',
                    group:'',
                    pid:'',
                },
                keyForm:{
                    userid:'',
                    pass:'',
                    usernm:'',
                    email:'',
                },
                methods:{
                }
            },
        });

        $("#goSelect").click(function(){
            search();
        });
        $("#goAdd").click(function(){
           grid.dataProvider.addRow({},0);
        });
        $("#goSave").click(function(){
            maintList('insert');
        });
        $("#goUserSave").click(function(){
            UserSaveList('insert');
        });
        $("#goDelete").click(function(){
            maintDelete('delete');
        });

        grid = {
        //GRID ID
        // GRID 필드 값
        // GRID 컬럼 값
            id:"realgrid",
            fields:fields,
            columns:columns,
        }
        grid2 = {
            id:"realgrid2",
            height:240,
            fields:fields,
            resize:false,
            columns:columns1,
        }
        //createGrid("realgrid");
        setResizeHeightObjs("realgrid","realgrid2");

        createRGrid(grid);
        createRGrid(grid2);
        //그리드 행 선택 이벤트
        //grid 이벤트 REALGRID 가이드 참조
        //function(grid,cell) 그리드, 선택된 셀
        grid.gridView.onCellClicked = function(g,
        cell) {
            cell.itemIndex
            //var row = grid.dataProvider.getJsonRow(cell.itemIndex);
            var id = grid.gridView.getValue(cell.itemIndex,"userid");

            selectUserInfo(id);
            searchDetail(id);
        };

        //ContextMenu 선언
        grid.gridView.setContextMenu([
            {
                label:"행추가",
                tag :"insert"
            }
        ]);

        //컨텍스트 메뉴 클릭 이벤트
        grid.gridView.onContextMenuItemClicked  = function(grid,label,index){
            if(label.tag == "insert"){
                if(index == 0){
                  // 그리드에 선택된 행이 없을경우 맨마지막에 행추가
                  // 아래 화살표 기능으로 행추가 가능능
                    grid.beginAppendRow();
                    grid.showEditor();
                    grid.setFocus();
                }else{
                  // 현재 선택된 그리드 상단에 행 삽입
                  // insert 키로 사용가능
                    grid.beginInsertRow(Math.max(0,index),true);
                    grid.showEditor();
                    grid.setFocus();
                }
            }
        };
        search();


    });


    var pid ;

    function search(group){
        pid = "";
        grid2.gridView.commit(false);
        grid.dataProvider.clearRows();
        grid2.dataProvider.clearRows();

        app.keys.group = group;
        var jsonData = {
                map: app.keys,
        };

        fn_transaction("select","/service/system/userMgt/selectList.do/selectList",jsonData,fn_callback);
    }
    function selectUserInfo(id){
        app.keys.id = id;
        var jsonData = {
                map: app.keys,
        };

        fn_transaction("selectUserInfo","/service/system/userMgt/selectList.do/selectUserInfo",jsonData,fn_callback);
    }
    function searchDetail(_pid){
        pid = _pid;
        grid2.gridView.commit(false);
        grid2.dataProvider.clearRows();

        app.keys.pid = pid;
        var jsonData = {
                map: app.keys,
        };

        fn_transaction("select2","/service/system/userMgt/selectList.do/selectList2",jsonData,fn_callback);
    }

    function UserSaveList(func, key){

            grid.gridView.commit(true);

        var searchParam = {};
        searchParam.func = func;
        var list = getCheckedRows(grid);



            var listData = {
                  list: list,
            };

        fn_transaction(func,"/service/system/userMgt/maintList.do/maintUserList",listData,fn_callback);
        return;

    }


    function maintList(func,key){
        grid2.gridView.commit(true);

        var searchParam = {};
        searchParam.func = func;
        var list = getCheckedRows(grid2);



            var listData = {
                  list: list,
                  map:app.keyForm,
            };

        fn_transaction(func,"/service/system/userMgt/maintList.do/"+func+"List",listData,fn_callback);

        return;
    }
    function maintDelete(func,key){
        grid2.gridView.commit(true);

        var searchParam = {};
        searchParam.func = func;
        var list = getCheckedRows(grid2);



            var listData = {
                  list: list,
                  map:app.keyForm,
            };
        fn_transaction(func,"/service/system/userMgt/maintList.do/"+func+"List",listData,fn_callback);

        return;
    }
    function fn_callback(func,data,status){
        if(data.error){
            alert(data.error);
        }else{
             if(func == "select"){
                grid.dataProvider.setRows(data.resultList);
                app.keyForm={};
            }else if(func == "select2"){
                grid2.dataProvider.setRows(data.resultList);
            }else if(func=="selectUserInfo"){
                app.keyForm = data.resultList[0];
            }else{
                fn_alert(data.message);
            }
        }
    }

</script>
<body>
<div id="form" class="contentPgm">
    <div class="content_title">사용자관리</div>
    <div class="box_Atype">
        <table class="tbl_base">
            <caption>사용자관리</caption>
            <colgroup>
                <col style="width:150px;"/>
                <col style="width:300px;"/>
                <col style="width:150px;"/>
                <col style="width:300px;"/>
                <col style="width:150px;"/>
                <col style="width:300px;"/>
                <col style="width:150px;"/>
                <col style="width:300px;"/>
                <col style="width:*;"/>
            </colgroup>
            <tbody>
            <tr>
                <td class="ar">회사</td>
                <td>
                    <select name="comp" id="comp" class="ui_sel w100p" v-model="keys.comp">
                        <option value="">전체</option>
                        <option value="1">1번회사</option>
                        <option value="2">2번회사</option>
                        <option value="3">3번회사</option>
                    </select>
                </td>
                <td class="ar">지역</td>
                <td>
                    <select name="loct" id="loct" class="ui_sel w100p" v-model="keys.loct">
                        <option value="">전체</option>
                        <option value="1">서울</option>
                        <option value="2">부산</option>
                        <option value="3">울산</option>
                        <option value="4">대구</option>
                        <option value="5">대전</option>
                    </select>
                </td>
                <td class="ar">조직/조직명</td>
                <td>
                    <input id="group" type="text" class="input_A w90p"  v-model="keys.search3">
                </td>
                <td class="ar">사번/성명</td>
                <td>
                    <input id="usernm" type="text" class="input_A w90p"  v-model="keys.search4">
                </td>
                <td></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="gap5"></div>
    <table class="tbl_base" style ="border-cpllapse: collapse;">
        <colgroup>
            <col style="width:68%">
            <col style="width:30%">
        </colgroup>
        <tbody>
            <tr>
                <td style="vertical-align:top;" colspan="2">
                    <div class="ar" style="margin-bottom:5px">
                        <div id="goSelect" class="btn_typeA btn_search">조회</div>
                        <div id="goAdd" class="btn_typeA btn_save">사용자 추가</div>
                        <div id="goUserSave" class="btn_typeA btn_save">사용자 저장</div>
                        <div id="goSave" class="btn_typeA btn_save">권한저장</div>
                        <div id="goDelete" class="btn_typeA btn_delete">삭제</div>
                        <div id="goExcel" class="btn_typeA btn_excel">Excel</div>
                    </div>
                </td>
            </tr>
            <tr>
                <td  style="vertical-align:top;"  rowspan="2">
                    <div id="realgrid"  ></div>
                    <div class="paging" id="gridPageBarDiv" style="height:20px; "></div>
                </td>
                <td style="vertical-align:top; height:45%">
                    <div id="realgrid2"  style="vertical-align:top; display: block;"></div>
                    <div class="paging" id="gridPageBarDiv2" style="height:30px; vertical-align:top; display:block; "></div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</body>
</html>