<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>연차관리현황</title>
    <div th:replace="headerRGrid"></div>
</head>
<style>
    .total { background: #e4e7eb; }
    .total2 { background: #e4e7eb; color: #3b77ff; font-weight: bold; }
    .point { color: #3b77ff; font-weight: bold; }
</style>
<script>
    var fields = [
      {fieldName: "user_id",dataType: "text"},
      {fieldName: "user_nm",dataType: "text"},
      {fieldName: "rbof_id",dataType: "text"},
      {fieldName: "rbof_nm",dataType: "text"},

      {fieldName: "half_yvc01",dataType: "number",subType: "uint"},
      {fieldName: "half_yvc02",dataType: "number",subType: "uint"},
      {fieldName: "half_yvc03",dataType: "number",subType: "uint"},
      {fieldName: "half_yvc04",dataType: "number",subType: "uint"},
      {fieldName: "half_yvc05",dataType: "number",subType: "uint"},
      {fieldName: "half_yvc06",dataType: "number",subType: "uint"},
      {fieldName: "half_yvc07",dataType: "number",subType: "uint"},
      {fieldName: "half_yvc08",dataType: "number",subType: "uint"},
      {fieldName: "half_yvc09",dataType: "number",subType: "uint"},
      {fieldName: "half_yvc10",dataType: "number",subType: "uint"},
      {fieldName: "half_yvc11",dataType: "number",subType: "uint"},
      {fieldName: "half_yvc12",dataType: "number",subType: "uint"},

      {fieldName: "full_yvc01",dataType: "number",subType: "uint"},
      {fieldName: "full_yvc02",dataType: "number",subType: "uint"},
      {fieldName: "full_yvc03",dataType: "number",subType: "uint"},
      {fieldName: "full_yvc04",dataType: "number",subType: "uint"},
      {fieldName: "full_yvc05",dataType: "number",subType: "uint"},
      {fieldName: "full_yvc06",dataType: "number",subType: "uint"},
      {fieldName: "full_yvc07",dataType: "number",subType: "uint"},
      {fieldName: "full_yvc08",dataType: "number",subType: "uint"},
      {fieldName: "full_yvc09",dataType: "number",subType: "uint"},
      {fieldName: "full_yvc10",dataType: "number",subType: "uint"},
      {fieldName: "full_yvc11",dataType: "number",subType: "uint"},
      {fieldName: "full_yvc12",dataType: "number",subType: "uint"},

      {fieldName: "half_total",dataType: "number",subType: "uint"},
      {fieldName: "full_total",dataType: "number",subType: "uint"}
    ];

    var columns = [
      {name: "user_id", fieldName: "user_id", type: "data", width: "140", header: "사원ID", visible: false },
      {name: "user_nm", fieldName: "user_nm", type: "data", width: "141", header: "사원명", editable: false },
      {name: "rbof_id", fieldName: "rbof_id", type: "data", width: "140", header: "직책ID", visible: false },
      {name: "rbof_nm", fieldName: "rbof_nm", type: "data", width: "100", header: "직책", editable: false },

      {name: "half_yvc01", fieldName: "half_yvc01", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "반차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "half_yvc02", fieldName: "half_yvc02", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "반차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "half_yvc03", fieldName: "half_yvc03", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "반차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "half_yvc04", fieldName: "half_yvc04", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "반차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "half_yvc05", fieldName: "half_yvc05", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "반차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "half_yvc06", fieldName: "half_yvc06", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "반차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "half_yvc07", fieldName: "half_yvc07", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "반차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "half_yvc08", fieldName: "half_yvc08", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "반차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "half_yvc09", fieldName: "half_yvc09", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "반차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "half_yvc10", fieldName: "half_yvc10", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "반차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "half_yvc11", fieldName: "half_yvc11", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "반차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "half_yvc12", fieldName: "half_yvc12", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "반차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },

      {name: "full_yvc01", fieldName: "full_yvc01", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "연차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "full_yvc02", fieldName: "full_yvc02", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "연차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "full_yvc03", fieldName: "full_yvc03", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "연차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "full_yvc04", fieldName: "full_yvc04", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "연차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "full_yvc05", fieldName: "full_yvc05", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "연차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "full_yvc06", fieldName: "full_yvc06", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "연차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "full_yvc07", fieldName: "full_yvc07", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "연차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "full_yvc08", fieldName: "full_yvc08", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "연차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "full_yvc09", fieldName: "full_yvc09", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "연차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "full_yvc10", fieldName: "full_yvc10", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "연차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "full_yvc11", fieldName: "full_yvc11", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "연차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },
      {name: "full_yvc12", fieldName: "full_yvc12", type: "data", width: "52", numberFormat: "#,##0", editor:{"type":"number","max":15,"maxIntegerLength": 2}, header: "연차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'point'; } return ret; }
      },

      {name: "half_total", fieldName: "half_total", type: "data", width: "52", styleName: "total", numberFormat: "#,##0", header: "반차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'total2'; } return ret; }, editable: false
      },
      {name: "full_total", fieldName: "full_total", type: "data", width: "52", styleName: "total", numberFormat: "#,##0", header: "연차",
       styleCallback: function(grid, dataCell) { var ret = {}; if ((dataCell.value > 0)){ ret.styleName = 'total2'; } return ret; }, editable: false
      }
    ];

    <!-- 레이아웃 헤더(헤더 병합) -->
    var layout1 = [
        "user_id", "user_nm", "rbof_id", "rbof_nm",
        {name: "month01", direction: "horizontal", items: ["half_yvc01","full_yvc01"], header: "1월"},
        {name: "month02", direction: "horizontal", items: ["half_yvc02","full_yvc02"], header: "2월"},
        {name: "month03", direction: "horizontal", items: ["half_yvc03","full_yvc03"], header: "3월"},
        {name: "month04", direction: "horizontal", items: ["half_yvc04","full_yvc04"], header: "4월"},
        {name: "month05", direction: "horizontal", items: ["half_yvc05","full_yvc05"], header: "5월"},
        {name: "month06", direction: "horizontal", items: ["half_yvc06","full_yvc06"], header: "6월"},
        {name: "month07", direction: "horizontal", items: ["half_yvc07","full_yvc07"], header: "7월"},
        {name: "month08", direction: "horizontal", items: ["half_yvc08","full_yvc08"], header: "8월"},
        {name: "month09", direction: "horizontal", items: ["half_yvc09","full_yvc09"], header: "9월"},
        {name: "month10", direction: "horizontal", items: ["half_yvc10","full_yvc10"], header: "10월"},
        {name: "month11", direction: "horizontal", items: ["half_yvc11","full_yvc11"], header: "11월"},
        {name: "month12", direction: "horizontal", items: ["half_yvc12","full_yvc12"], header: "12월"},
        {name: "total", direction: "horizontal", items: ["half_total","full_total"], header: "계"}
    ];

    var grid;

    var app;
    $(document.body).ready(function(){
        app = new Vue({
            el:'#form',
            data:{
                rbofList:[],
                keys:{
                	user_nm:'',
                	rbof_id:''
                },
                methods:{
                }
            },
        });

        $("#goSelect").click(function(){
        	app.keys.pagenum = 1; // 조회버튼 클릭시 현재페이지 1로 초기화
        	search();
        });

        $("#goSave").click(function(){
            maintList('maint');
        });

        $("#goExcel").click(function(){
        	grid.gridView.exportGrid({
			    type: "excel",
			    target: "local",
			    fileName: "연차 관리.xlsx",
			    showProgress: true,
			    progressMessage: "엑셀 Export중입니다.",
			    indicator: 'visible',
			    header: 'visible',
			    footer: 'visible',
			    compatibility: true,
			    done: function () {  //내보내기 완료 후 실행되는 함수
			        // alert("done excel export")
			    }
			});
        });

        grid = {
            id:"realgrid",
            fields:fields,
            columns:columns,
            layout:layout1,
            pagenum:1, // 현재 페이지 번호
            pagerows:100, // 페이지당 표시할 데이터 건수
        }

        createRGrid(grid);
        grid.gridView.setColumnLayout(grid.layout);
        grid.gridView.displayOptions.selectionStyle = "rows"

        setResizeHeightObjs("realgrid");
        grid.gridView.refresh();

        fn_codeDataSync({group:"RBOF"},function(list){
            app.rbofList = list;
        });

        search();
    });

    function search(){
        grid.dataProvider.clearRows();
        app.keys.pagenum = grid.pagenum;

        var jsonData = {
                map: app.keys,
        };

        grid.gridView.setFixedOptions({
          colCount: 2
        });

        fn_transaction("select","/service/pms/yvcMgt/selectList.do/selectList",jsonData,fn_callback);
    }
    async function maintList(func,key){
        grid.gridView.commit(true);

        var searchParam = {};
        searchParam.func = func;

        var list = getCheckedRows(grid);

        if(list.length < 1){
          fn_alert("자료를 선택하세요.");
          return;
        }

        var rtn = await fn_confirm("저장하시겠습니까?");

        if(rtn == 'Y' && list.length >0){
            var listData = {
                  list: list,
            };
            fn_transaction(func,"/service/pms/yvcMgt/maintList.do/"+func+"List",listData,fn_callback);
        }
        return;
    }
    function fn_callback(func,data,status){
        if(data.error){
            alert(data.error);
        }else{
             if(func == "select"){
                grid.dataProvider.setRows(data.resultList);
                grid.gridView.refresh();

                commonPaging(grid, data.resultList[0].tcnt, search);
            }else if(func == "maint"){
            	 grid.gridView.refresh();
            	 fn_alert('정상적으로 저장되었습니다.');
            }else{
                grid.gridView.refresh();
                fn_alert(data.message);
            }
        }
    }
    $(window).resize(function(){
        grid.gridView.refresh();
    });
</script>
<body>
<div id="form" class="contentPgm">
    <div class="content_title">연차관리현황</div>
    <div class="box_Atype">
        <table class="tbl_base">
            <caption>연차관리현황</caption>
            <colgroup>
                <col style="width:150px;"/>
                <col style="width:300px;"/>
                <col style="width:150px;"/>
                <col style="width:150px;"/>
                <col style="width:*;"/>
            </colgroup>
            <tbody>
            <tr>
                <td class="ar">사원명</td>
                <td>
                    <input id="user_nm" type="text" class="input_A w90p"  v-model="keys.user_nm">
                </td>
                <td class="ar">직책</td>
                <td>
                    <select name="rbof_id" id="rbof_id" class="ui_sel w90p" v-model="keys.rbof_id">
                        <option value="">전체</option>
                        <option v-for="list in rbofList" :value="list.value">{{list.text}}</option>
                    </select>
                </td>
                <td></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="gap5"></div>

    <div class="ar">
        <div id="goSelect" class="btn_typeA btn_search">조회</div>
        <div id="goSave" class="btn_typeA btn_save">저장</div>
        <div id="goExcel" class="btn_typeA btn_excel">Excel</div>
    </div>
    <div class="gap10"></div>
    <div style="width: 100%;height: auto;overflow: hidden;">
        <div id="realgrid"  ></div>
        <div id="commonPaging" class="commonPaging" ></div>
    </div>
</div>
</body>
</html>